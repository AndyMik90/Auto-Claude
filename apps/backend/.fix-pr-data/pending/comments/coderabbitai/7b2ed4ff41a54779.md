# Comment: 7b2ed4ff41a54779

**Source:** coderabbitai
**Type:** comment
**File:** `apps/frontend/src/main/ipc-handlers/linear-handlers.ts`
**Original ID:** 2713898449
**Created:** None
**Severity:** HIGH
**Status:** PENDING

---

## Original Content

_‚ö†Ô∏è Potential issue_ | _üü† Major_

<details>
<summary>üß© Analysis chain</summary>

üèÅ Script executed:

```shell
#!/bin/bash
# Find the platform module referenced in learnings
fd -type f -name "*platform*" --extension ts --extension tsx --extension js

# Check directory structure
git ls-files | grep -E "(platform|module)" | head -20
```

Repository: AndyMik90/Auto-Claude

Length of output: 1258

---

üèÅ Script executed:

```shell
#!/bin/bash
# Search for all instances of process.env.HOME in the codebase
rg -n "process\.env\.HOME" --type=ts --type=tsx -C2
```

Repository: AndyMik90/Auto-Claude

Length of output: 92

---

üèÅ Script executed:

```shell
#!/bin/bash
# Search for the platform abstraction functions mentioned in learnings
rg -n "export.*function.*(isWindows|isMacOS|isLinux|joinPaths|findExecutable)" --type=ts --type=tsx
```

Repository: AndyMik90/Auto-Claude

Length of output: 92

---

üèÅ Script executed:

```shell
#!/bin/bash
# Read the platform module files to understand available functions
echo "=== Platform Index ===" 
cat apps/frontend/src/main/platform/index.ts

echo -e "\n=== Platform Paths ===" 
cat apps/frontend/src/main/platform/paths.ts

echo -e "\n=== Platform Types ===" 
cat apps/frontend/src/main/platform/types.ts
```

Repository: AndyMik90/Auto-Claude

Length of output: 20292

---

üèÅ Script executed:

```shell
#!/bin/bash
# Search for process.env.HOME with corrected syntax (no --type argument)
rg -n "process\.env\.HOME" -C2
```

Repository: AndyMik90/Auto-Claude

Length of output: 4398

---

üèÅ Script executed:

```shell
#!/bin/bash
# Search for uses of os.homedir in the codebase
rg -n "homedir" -C2
```

Repository: AndyMik90/Auto-Claude

Length of output: 24287

---

üèÅ Script executed:

```shell
#!/bin/bash
# Check the linear-handlers.ts file to see imports and context
head -50 apps/frontend/src/main/ipc-handlers/linear-handlers.ts
```

Repository: AndyMik90/Auto-Claude

Length of output: 1712

---

üèÅ Script executed:

```shell
#!/bin/bash
# Check the exact area around line 744-771
sed -n '740,775p' apps/frontend/src/main/ipc-handlers/linear-handlers.ts
```

Repository: AndyMik90/Auto-Claude

Length of output: 835

---

üèÅ Script executed:

```shell
#!/bin/bash
# Check what's imported at the top of linear-handlers.ts
grep -n "^import\|^const.*require" apps/frontend/src/main/ipc-handlers/linear-handlers.ts | head -30
```

Repository: AndyMik90/Auto-Claude

Length of output: 647

---



</details>

**Cross-platform issue: `process.env.HOME` is undefined on Windows, breaking cache clearing.**

The code uses `process.env.HOME || '.'` to construct the cache directory path. On Windows, `process.env.HOME` is `undefined`, causing the cache path to resolve to `./.auto-claude/specs/.cache/linear_validator` instead of the user's home directory. This prevents proper cache cleanup on Windows.

Replace with `os.homedir()`, which returns the correct user home directory across all platforms (Windows, macOS, Linux):

```diff
+import { homedir } from 'os';
+
  ipcMain.handle(
    IPC_CHANNELS.LINEAR_CLEAR_CACHE,
    async (_): Promise<IPCResult<void>> => {
      try {
        const cacheDir = path.join(
-          process.env.HOME || '.',
+          homedir(),
          '.auto-claude',
          'specs',
          '.cache',
          'linear_validator'
        );
```

Note: Similar issues exist in other files (terminal-handlers.ts:284, worktree-handlers.ts:954/1024, terminal-store.ts:157/233). Consider fixing them as well for consistency.

<!-- suggestion_start -->

<details>
<summary>üìù Committable suggestion</summary>

> ‚ÄºÔ∏è **IMPORTANT**
> Carefully review the code before committing. Ensure that it accurately replaces the highlighted code, contains no missing lines, and has no issues with indentation. Thoroughly test & benchmark the code to ensure it meets the requirements.

```suggestion
import { homedir } from 'os';

  ipcMain.handle(
    IPC_CHANNELS.LINEAR_CLEAR_CACHE,
    async (_): Promise<IPCResult<void>> => {
      try {
        const cacheDir = path.join(
          homedir(),
          '.auto-claude',
          'specs',
          '.cache',
          'linear_validator'
        );

        const fs = await import('fs/promises');
        try {
          await fs.rm(cacheDir, { recursive: true, force: true });
        } catch {
          // Cache dir might not exist, that's ok
        }

        return { success: true, data: undefined };
      } catch (error) {
        return {
          success: false,
          error: error instanceof Error ? error.message : 'Failed to clear cache'
        };
      }
    }
  );
```

</details>

<!-- suggestion_end -->

<details>
<summary>ü§ñ Prompt for AI Agents</summary>

```
In `@apps/frontend/src/main/ipc-handlers/linear-handlers.ts` around lines 744 -
771, The cache-clear handler registered for IPC_CHANNELS.LINEAR_CLEAR_CACHE
builds cacheDir using process.env.HOME which is undefined on Windows; change it
to use os.homedir() (import os from 'os') when constructing the path inside the
ipcMain.handle async callback so the path resolves cross-platform. Update the
cacheDir construction in the LINEAR_CLEAR_CACHE handler (and mirror the same
replacement in terminal-handlers.ts, worktree-handlers.ts, and terminal-store.ts
where process.env.HOME is used) to ensure correct home directory resolution on
Windows, macOS, and Linux.
```

</details>

<!-- fingerprinting:phantom:medusa:ocelot -->

<!-- This is an auto-generated comment by CodeRabbit -->

---

## Suggested Fix

```typescript
</details>

<!-- suggestion_end -->

<details>
<summary>ü§ñ Prompt for AI Agents</summary>
```

---

## Implementation Notes

*Status: PENDING - Not yet verified or implemented*

### Verification Checklist

- [ ] Read file at comment location
- [ ] Verify if issue is already fixed
- [ ] Implement fix if needed
- [ ] Re-verify after implementation

