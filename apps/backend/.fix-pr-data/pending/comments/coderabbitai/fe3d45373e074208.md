# Comment: fe3d45373e074208

**Source:** coderabbitai
**Type:** comment
**File:** `apps/frontend/src/main/agent/agent-manager.ts`
**Line:** 578
**Original ID:** 2717221776
**Created:** None
**Severity:** HIGH
**Status:** PENDING

---

## Original Content

_‚ö†Ô∏è Potential issue_ | _üü† Major_

**Missing timeout handling for spawned process.**

The PR description mentions a "5-minute per-ticket network timeout," but the spawned process has no timeout enforcement here. If the Python process hangs, this Promise will never resolve.



<details>
<summary>üîß Suggested fix - add timeout handling</summary>

```diff
 return new Promise((resolve) => {
   const { spawn } = require("child_process");
   const pythonCommand = this.processManager.getPythonPath();
   let stdout = "";
   let stderr = "";
+  const TIMEOUT_MS = 5 * 60 * 1000; // 5 minutes

   const child = spawn(pythonCommand, args, {
     cwd: autoBuildSource,
     env: { ...process.env, ...combinedEnv },
   });

+  const timeoutId = setTimeout(() => {
+    child.kill('SIGTERM');
+    resolve({
+      success: false,
+      error: `Validation timed out after ${TIMEOUT_MS / 1000} seconds`,
+    });
+  }, TIMEOUT_MS);

   child.stdout?.on("data", (data: Buffer) => {
     stdout += data.toString();
   });

   child.stderr?.on("data", (data: Buffer) => {
     stderr += data.toString();
   });

   child.on("close", (code: number | null) => {
+    clearTimeout(timeoutId);
     if (code === 0 && stdout) {
       // ... rest of handler
     }
   });

   child.on("error", (err: Error) => {
+    clearTimeout(timeoutId);
     resolve({
       success: false,
       error: `Failed to spawn validation process: ${err.message}`,
     });
   });
 });
```
</details>

<details>
<summary>ü§ñ Prompt for AI Agents</summary>

```
In `@apps/frontend/src/main/agent/agent-manager.ts` around lines 534 - 578, The
promise that spawns the Python process via spawn (see spawn(...) usage and
this.processManager.getPythonPath() in the agent-manager.ts block) lacks timeout
handling so a hung Python process will never resolve; add a configurable timeout
(e.g., 5 minutes) using setTimeout when the child is created, store the timer
id, and on timeout call child.kill() (or child.kill('SIGKILL') if needed) and
resolve with a failure object (success: false, error: 'Validation timed out
after X ms'); also clear the timer in the child.on('close') and
child.on('error') handlers to avoid races and ensure you don't double-resolve
the promise.
```

</details>

<!-- fingerprinting:phantom:medusa:ocelot -->

<!-- This is an auto-generated comment by CodeRabbit -->

---

## Suggested Fix

```typescript
</details>

<details>
<summary>ü§ñ Prompt for AI Agents</summary>
```

---

## Implementation Notes

*Status: PENDING - Not yet verified or implemented*

### Verification Checklist

- [ ] Read file at comment location
- [ ] Verify if issue is already fixed
- [ ] Implement fix if needed
- [ ] Re-verify after implementation

