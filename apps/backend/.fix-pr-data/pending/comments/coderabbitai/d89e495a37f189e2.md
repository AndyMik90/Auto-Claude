# Comment: d89e495a37f189e2

**Source:** coderabbitai
**Type:** comment
**File:** `apps/backend/tests/integration/test_linear_mcp.py`
**Line:** 355
**Original ID:** 2737528203
**Created:** None
**Severity:** HIGH
**Status:** PENDING

---

## Original Content

_‚ö†Ô∏è Potential issue_ | _üü† Major_

**Batch limit test should not call external services.**

`validate_batch` will invoke real validation unless mocked, which can fail in CI without API keys.

<details>
<summary>üß™ Mock validation to keep this test deterministic</summary>

```diff
+from unittest.mock import AsyncMock
@@
-    async def test_batch_validation_limit_enforcement(self):
+    async def test_batch_validation_limit_enforcement(self, monkeypatch):
@@
-            agent = LinearValidationAgent(spec_dir=spec_dir, project_dir=project_dir)
+            agent = LinearValidationAgent(spec_dir=spec_dir, project_dir=project_dir)
+            monkeypatch.setattr(
+                agent,
+                "validate_ticket",
+                AsyncMock(return_value={"status": "complete"}),
+            )
@@
-            await agent.validate_batch(five_tickets)  # Should not raise
+            await agent.validate_batch(five_tickets)  # Should not raise
```
</details>

<details>
<summary>ü§ñ Prompt for AI Agents</summary>

```
In `@apps/backend/tests/integration/test_linear_mcp.py` around lines 321 - 355,
The test calls LinearValidationAgent.validate_batch which currently triggers
real external validation; to avoid network/API usage, monkeypatch or patch the
internal per-ticket validation used by validate_batch (e.g., patch
LinearValidationAgent.validate or whatever internal method validate_batch calls)
to a no-op or deterministic stub before invoking validate_batch; alternatively
patch validate_batch_limit to only check count and not perform external
validation. Ensure you reference LinearValidationAgent.validate_batch (and
validate_batch_limit) when locating the change and use pytest's monkeypatch or
unittest.mock.patch.object to replace the real validation with a stub that
returns success so the test remains deterministic and does not require API keys.
```

</details>

<!-- fingerprinting:phantom:poseidon:eagle -->

<!-- This is an auto-generated comment by CodeRabbit -->

---

## Implementation Notes

*Status: PENDING - Not yet verified or implemented*

### Verification Checklist

- [ ] Read file at comment location
- [ ] Verify if issue is already fixed
- [ ] Implement fix if needed
- [ ] Re-verify after implementation

