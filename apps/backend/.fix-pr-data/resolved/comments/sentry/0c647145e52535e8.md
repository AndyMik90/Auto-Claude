# Comment: 0c647145e52535e8

**Source:** sentry
**Type:** comment
**File:** `apps/backend/agents/linear_similarity_agent.py`
**Original ID:** 2737893836
**Created:** None
**Severity:** HIGH
**Status:** RESOLVED

---

## Original Content

**Bug:** The async function `_fetch_team_tickets` makes a synchronous, blocking network call using `requests.post()`, which will block the event loop.
<sub>Severity: HIGH</sub>
<!-- BUG_PREDICTION -->

<details>
<summary><b title="Reference ID: `9347267`">Suggested Fix</b></summary>

Wrap the blocking `requests.post()` call within `asyncio.to_thread()` to run it in a separate thread. This will prevent it from blocking the main asyncio event loop, allowing other tasks to run concurrently. This pattern is already correctly implemented in `fetch_linear_ticket()` in `linear_utils.py`.
</details>

<details open>
<summary><b title="Reference ID: `9347267`">Prompt for AI Agent</b></summary>

```
Review the code at the location below. A potential bug has been identified by an AI
agent.
Verify if this is a real issue. If it is, propose a fix; if not, explain why it's not
valid.

Location: apps/backend/agents/linear_similarity_agent.py#L343-L348

Potential issue: The `async` function `_fetch_team_tickets` uses the synchronous
`requests.post()` method, which blocks the asyncio event loop. During the HTTP request,
which has a 30-second timeout, other concurrent async tasks are prevented from
executing. This same blocking I/O pattern is also present in `_fetch_linear_issue`
within `linear_validator.py`, which is called from the async `validate_ticket` function.
This is particularly problematic during batch validation, as it defeats the purpose of
using `asyncio.Semaphore` for concurrency, causing tickets to be processed sequentially
rather than in parallel.
```
</details>

<!--
<sub>Reference ID: `9347267`</sub>-->

---

## Suggested Fix

```python
Review the code at the location below. A potential bug has been identified by an AI
agent.
Verify if this is a real issue. If it is, propose a fix; if not, explain why it's not
valid.

Location: apps/backend/agents/linear_similarity_agent.py#L343-L348

Potential issue: The `async` function `_fetch_team_tickets` uses the synchronous
`requests.post()` method, which blocks the asyncio event loop. During the HTTP request,
which has a 30-second timeout, other concurrent async tasks are prevented from
executing. This same blocking I/O pattern is also present in `_fetch_linear_issue`
within `linear_validator.py`, which is called from the async `validate_ticket` function.
This is particularly problematic during batch validation, as it defeats the purpose of
using `asyncio.Semaphore` for concurrency, causing tickets to be processed sequentially
rather than in parallel.
```

---

## Implementation Notes

*Status: RESOLVED*

**Resolution:** Fixed in commit 99523a7d: Wrapped _fetch_team_tickets requests.post() in asyncio.to_thread()

### Fix Commit

`99523a7d`