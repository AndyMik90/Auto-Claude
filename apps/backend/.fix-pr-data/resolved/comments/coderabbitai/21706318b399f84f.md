# Comment: 21706318b399f84f

**Source:** coderabbitai
**Type:** comment
**File:** `apps/backend/tests/test_linear_validation.py`
**Original ID:** 2713898429
**Created:** None
**Severity:** HIGH
**Status:** SKIPPED

---

## Original Content

_‚ö†Ô∏è Potential issue_ | _üü† Major_

**Cache key test assertion may fail due to timestamp sanitization.**

The test expects `cache_key == "LIN-123:2024-01-18T10:00:00Z"` but looking at `_get_cache_key` implementation (linear_validator.py lines 390-394), colons in the timestamp are replaced with underscores. The actual result would be `"LIN-123:2024-01-18T10_00_00Z"`.

<details>
<summary>Proposed fix</summary>

```diff
     def test_cache_key_format(self):
         """Cache key should be in format 'issue_id:timestamp'."""
         # ...
         cache_key = agent._get_cache_key("LIN-123", "2024-01-18T10:00:00Z")
-        assert cache_key == "LIN-123:2024-01-18T10:00:00Z"
+        # Note: colons in timestamp are sanitized to underscores
+        assert cache_key == "LIN-123:2024-01-18T10_00_00Z"
```

Similarly for `test_cache_key_different_timestamps` and `test_cache_key_with_colon_in_issue_id`.
</details>

<details>
<summary>ü§ñ Prompt for AI Agents</summary>

```
In `@apps/backend/tests/test_linear_validation.py` around lines 248 - 256, The
tests assume timestamps keep colons but _get_cache_key (in linear_validator.py)
sanitizes colons to underscores; update the three tests (test_cache_key_format,
test_cache_key_different_timestamps, test_cache_key_with_colon_in_issue_id in
apps/backend/tests/test_linear_validation.py) to expect the sanitized form
(e.g., "LIN-123:2024-01-18T10_00_00Z") or alternatively change _get_cache_key to
not replace ':' if you prefer; keep the test expectations consistent with the
_get_cache_key behavior.
```

</details>

<!-- fingerprinting:phantom:medusa:ocelot -->

<!-- This is an auto-generated comment by CodeRabbit -->

---

## Suggested Fix

```python
Similarly for `test_cache_key_different_timestamps` and `test_cache_key_with_colon_in_issue_id`.
</details>

<details>
<summary>ü§ñ Prompt for AI Agents</summary>
```

---

## Implementation Notes

*Status: SKIPPED*

**Resolution:** Already fixed - uses safe fallback pattern with ...(currentResult || {...})