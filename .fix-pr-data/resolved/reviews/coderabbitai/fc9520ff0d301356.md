# Review: fc9520ff0d301356

**Source:** coderabbitai
**Type:** review
**Original ID:** 3715887895
**Created:** None
**Severity:** MEDIUM
**Status:** SKIPPED

---

## Original Content

**Actionable comments posted: 23**

<details>
<summary>ü§ñ Fix all issues with AI agents</summary>

```
In `@apps/backend/agents/linear_resolution_agent.py`:
- Around line 211-217: Duplicate helper logic exists in _format_labels and
_fetch_linear_ticket across linear_resolution_agent.py and
linear_similarity_agent.py; extract these into a shared utility module (e.g.,
apps/backend/agents/linear_utils.py) exposing format_labels and
fetch_linear_ticket (or similarly named functions), move the implementation
there (including any HTTP/async handling and logging used by
_fetch_linear_ticket), then update both agents to import and call the shared
functions instead of their local versions to remove duplication.
- Around line 360-400: The placeholder functions _get_recent_commits and
_get_recent_releases currently return hardcoded data; update them so they do not
silently run in production by detecting the environment (e.g., an ENV var or
existing config flag) and either log a clear warning via the project's logger or
raise an exception when not in development/test, and keep the current hardcoded
return only for explicit dev/test flows; specifically modify _get_recent_commits
and _get_recent_releases to check a runtime flag (e.g., IS_DEV or
settings.DEBUG), call the project's logger to emit a warning that placeholder
data is being used, and raise an error (or return an empty list) when running in
non-development environments to prevent accidental production use.
- Around line 139-144: The call to run_agent_session erroneously passes a
non-existent max_iterations parameter which will raise a runtime error; remove
the max_iterations=1 argument from the invocation in linear_resolution_agent.py
so the call matches the function signature (run_agent_session(client, message,
spec_dir, verbose=None, phase=None)), keeping the existing client and prompt
variables and the explicit None for spec_dir.
- Around line 310-318: The model fallback is hardcoded in two places; replace
the duplicated literal with the centralized helper by calling get_phase_model()
and using its return for both create_client(...) and LinearResolutionAgent(...).
Locate the create_client invocation and the LinearResolutionAgent constructor
and pass model=get_phase_model() (or model=model or get_phase_model() if
optionally provided) so both call sites use the same resolved model from
phase_config.get_phase_model; also import get_phase_model at top if not already
imported.
- Around line 229-230: Move the in-function imports of json and re out of
_parse_resolution_response and place them with the other top-level imports in
this module; update references in _parse_resolution_response to use the
top-level json and re (remove the import lines inside the method) so imports are
resolved once at module load and not on every call.
- Around line 84-91: The __init__ of LinearResolutionAgent currently hardcodes
the model; update it to resolve model and thinking budget from user settings by
calling get_phase_model() and get_phase_thinking_budget() from phase_config.py
and storing their results on the instance (e.g., self.model and
self.thinking_budget) before any Claude agent client is created; ensure any
subsequent construction of Claude clients in this class uses these instance
attributes instead of the hardcoded string (reference:
LinearResolutionAgent.__init__, get_phase_model, get_phase_thinking_budget).
- Around line 345-357: The try/except block in linear_resolution_agent.py uses
the synchronous requests.post (and response.raise_for_status()) inside an async
function, which blocks the event loop; replace it with an async HTTP client
(e.g., httpx.AsyncClient or aiohttp) by importing the async client, using an
async context manager (async with httpx.AsyncClient() as client:) and awaiting
the request (await client.post(...)) with the same json, headers and timeout,
calling await response.aread()/response.json() as appropriate, and catch the
async client's specific exceptions (e.g., httpx.HTTPError) to log the same
failure message for ticket_id; also update imports and ensure the client is
closed or used via context manager.
- Line 176: The description string currently slices ticket.get("description",
"No description") to 500 chars and always appends "..." which misleads for short
descriptions; update the logic in the LinearResolutionAgent method that builds
the Description field (look for the expression using ticket.get("description",
"No description")[:500]) to first store the full description, then if its length
is greater than 500 append "..." after slicing, otherwise use the full
description as-is (no ellipsis); ensure you reference the same variable when
constructing the final string so the ellipsis is conditional on original length.

In `@apps/backend/agents/linear_similarity_agent.py`:
- Around line 326-387: Both _fetch_linear_ticket and _fetch_team_tickets are
async but call the blocking requests.post; replace synchronous I/O with true
async I/O by using an async HTTP client (e.g., httpx.AsyncClient) or run the
blocking call in a thread via asyncio.to_thread. Specifically, in
_fetch_linear_ticket and _fetch_team_tickets: replace requests.post(...) with an
async client call (await client.post(...)) and await response.arelevant methods
(e.g., await response.json()) or, if using asyncio.to_thread, wrap the existing
requests.post and response.json in asyncio.to_thread calls; also update imports
accordingly and keep the existing error handling/return shape so
data.get("data", {}).get("issue") and the team issues extraction work the same.
- Around line 146-151: Remove the invalid max_iterations argument from the call
to run_agent_session in linear_similarity_agent.py (do not pass max_iterations),
and before creating the client resolve the model and thinking budget via
get_phase_model(...) and get_phase_thinking_budget(...) from phase_config.py and
use those values when instantiating the client; additionally, replace blocking
requests.post calls inside _fetch_linear_ticket and _fetch_team_tickets with an
async HTTP client (e.g., aiohttp or httpx AsyncClient) and await the requests so
the event loop is not blocked, ensuring you import and use the async API instead
of requests.post.
- Around line 265-317: The analyze_ticket_similarity function is missing a
spec_dir parameter so get_phase_model() and get_phase_thinking_budget(spec_dir,
...) cannot be used; update the function signature to accept spec_dir, call
get_phase_model(spec_dir, model) and get_phase_thinking_budget(spec_dir,
thinking_budget) before creating the client, pass the resolved model and
thinking budget into create_client(...) and into LinearSimilarityAgent(...), and
update any callers (e.g., linear_similarity_runner.py) to forward spec_dir when
invoking analyze_ticket_similarity.

In `@apps/backend/runners/linear_resolution_runner.py`:
- Around line 21-22: The top-level modification of sys.path via
sys.path.insert(0, str(Path(__file__).parent.parent)) in
linear_resolution_runner.py is fragile; remove that manipulation and instead
convert this script to a proper package entry point or use a __main__ module:
eliminate the sys.path.insert call and restructure imports so the module relies
on normal package imports (add a package __init__.py if needed) and register the
runner as an entry point in pyproject.toml (or expose a main() function and add
__main__.py) so consumers invoke linear_resolution_runner.main() via standard
packaging instead of altering sys.path.
- Around line 97-105: The current grouping (already_fixed, potentially_fixed,
still_open) can omit tickets (e.g., is_already_fixed==False and
recommended_action=="close"); update the grouping logic in
linear_resolution_runner.py to classify tickets exhaustively: keep already_fixed
= [t for t in tickets if t.get("is_already_fixed")], create groups for
recommended_action == "investigate" (potentially_fixed), "keep_open"
(still_open), "close" (closed_by_recommendation or similar), and collect any
remaining tickets into an other (or unknown) list; then ensure downstream code
emits or handles the other/close groups when non-empty so no ticket is silently
excluded.
- Around line 62-63: The ticket_ids list currently includes empty strings when
args.ticket_ids contains extra or trailing commas; modify the parsing expression
that assigns ticket_ids (the list comprehension using
args.ticket_ids.split(",")) to strip each part and exclude empty results (e.g.,
only include tid for which tid.strip() is non-empty) so downstream code receives
a clean list of ticket IDs.

In
`@apps/frontend/src/renderer/components/linear/components/LinearFilterControls.tsx`:
- Around line 45-88: PRIORITY_OPTIONS currently contains hardcoded English
labels; change it to use react-i18next translation keys by importing/using the t
function and replacing each label (e.g., "No
priority","Urgent","High","Medium","Low") with t('linear.priority.noPriority')
etc., and add the corresponding keys/values to both en/linear.json and
fr/linear.json; update any other occurrences in this file (and the referenced
range 610-639) to build user-facing strings through t, preserving the existing
value, icon, color and bgColor properties on PRIORITY_OPTIONS.

In `@apps/frontend/src/renderer/components/linear/components/LinearSearchBar.tsx`:
- Around line 24-31: Add an accessible label to the search input in
LinearSearchBar by passing an aria-label to the Input component (e.g.,
aria-label={ariaLabel || t("linear:searchPlaceholder")}). Update the Input JSX
in LinearSearchBar to include the aria-label prop and, if desired, accept an
optional ariaLabel prop from the component's props so callers can override the
default localized label; keep the existing placeholder and value/onChange
behavior.

In
`@apps/frontend/src/renderer/components/linear/components/LinearTicketItem.tsx`:
- Around line 1-5: Replace the relative imports with the repo TS path aliases:
change the LinearTicket import from "../../../../shared/types/integrations" to
"shared/types/integrations", change cn from "../../../lib/utils" to "lib/utils",
and change Badge from "../../ui/badge" to "components/ui/badge" (keep Clock,
User and useTranslation as-is); update the import statements in
LinearTicketItem.tsx to use these aliases so future refactors follow the
project's tsconfig paths.
- Around line 10-15: The file references React namespace types but doesn't
import them; add a named import from React (e.g., import React, { ReactNode,
MouseEvent } from 'react' or at minimum import { ReactNode, MouseEvent } from
'react') so usages in SrOnly ({ children }: { children: ReactNode }) and any
event handler signatures (e.g., onClick handlers typed with MouseEvent) compile
under strict TypeScript; update the top of the file to include these imports and
adjust any existing React.* type references to use the imported names if
desired.

In
`@apps/frontend/src/renderer/components/linear/components/ResolutionCheckDialog.tsx`:
- Around line 19-34: The local interfaces ResolutionEvidence and
ResolutionTicketResult in ResolutionCheckDialog.tsx should be removed and the
shared definitions imported from the central types file (use the existing types
in apps/frontend/src/shared/types/integrations.ts); replace the local
declarations with an import statement that brings in ResolutionEvidence and
ResolutionTicketResult, update any code that referenced the local types to use
the imported symbols, and delete the duplicate interface declarations to avoid
type drift.
- Around line 85-92: The combined close reason string in handleCloseSelected is
hardcoded and must be localized; update handleCloseSelected to use the i18n
translation key (e.g., call t('combinedCloseReason', { reasons: reasons.join(";
") })) when building combinedReason and pass that to onCloseTickets, and add the
key "combinedCloseReason": "Closed as resolved: {{reasons}}" to en/linear.json
and "combinedCloseReason": "Ferm√© comme r√©solu : {{reasons}}" to fr/linear.json
so interpolation works for both locales.

In
`@apps/frontend/src/renderer/components/linear/components/SimilarIssuesDialog.tsx`:
- Around line 142-147: The ‚Äú% match‚Äù label is hardcoded in SimilarIssuesDialog;
replace the literal with a react-i18next lookup using the existing translator
(t) and interpolate the percent value (e.g., use t('linear:matchPercent', {
percent: Math.round(ticket.similarity_score * 100) }) when rendering the
similarity text), and add the key linear:matchPercent to both en/*.json and
fr/*.json; also update the other occurrence in the same component that renders
the match text (the second similarity_score usage) to use the same
translated/interpolated key.

In `@apps/frontend/src/renderer/components/linear/components/ValidationModal.tsx`:
- Around line 173-199: The handleCreateTask async handler currently assumes
createTaskFromLinearTicket will throw on failure; update it to check the return
value from createTaskFromLinearTicket(ticketId, updatedValidation) and treat a
null result as an error: if the call returns null, call setError with a
descriptive message, setIsCreating(false), and do not call onOpenChange(false);
only close the modal (onOpenChange(false)) when a non-null task is returned.
Ensure you still catch thrown exceptions in the existing catch block and
setError/setIsCreating there as well.

In `@package.json`:
- Around line 47-50: Remove the frontend-only dependencies from the root
workspace and declare them in the frontend workspace: add "rehype-sanitize":
"^6.0.0" to the apps/frontend package.json dependencies alongside the existing
"lucide-react" entry, then delete both "lucide-react" and "rehype-sanitize" from
the root package.json dependencies to avoid duplication and ensure ownership is
clearly under the frontend workspace.
```

</details>

<!-- This is an auto-generated comment by CodeRabbit for review status -->

---

## Implementation Notes

*Status: SKIPPED*

**Reason:** Review state: COMMENTED

