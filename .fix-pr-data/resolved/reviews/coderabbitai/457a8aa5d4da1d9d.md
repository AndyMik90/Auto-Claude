# Review: 457a8aa5d4da1d9d

**Source:** coderabbitai
**Type:** review
**Original ID:** 3717785020
**Created:** None
**Severity:** MEDIUM
**Status:** SKIPPED

---

## Original Content

**Actionable comments posted: 4**

<details>
<summary>ðŸ¤– Fix all issues with AI agents</summary>

```
In `@apps/backend/tests/integration/test_linear_mcp.py`:
- Around line 321-355: The test calls LinearValidationAgent.validate_batch which
currently triggers real external validation; to avoid network/API usage,
monkeypatch or patch the internal per-ticket validation used by validate_batch
(e.g., patch LinearValidationAgent.validate or whatever internal method
validate_batch calls) to a no-op or deterministic stub before invoking
validate_batch; alternatively patch validate_batch_limit to only check count and
not perform external validation. Ensure you reference
LinearValidationAgent.validate_batch (and validate_batch_limit) when locating
the change and use pytest's monkeypatch or unittest.mock.patch.object to replace
the real validation with a stub that returns success so the test remains
deterministic and does not require API keys.
- Around line 137-162: The test test_linear_validation_agent_client_factory
creates a client via LinearValidationAgent.create_client but never closes it;
change the test to use the client's async context manager so the resource is
properly cleaned upâ€”make the test async (or use pytest.mark.asyncio) and replace
the direct call+assert with an "async with agent.create_client() as client:"
block, perform the assert inside that block, and keep the existing exception
handling/pytest.skip behavior around the async creation to handle missing
credentials.

In `@apps/backend/tests/test_linear_validation_runner.py`:
- Around line 9-15: Remove the unused top-level imports flagged by CodeQL:
delete the unused import names (os, tempfile, Path, Mock, patch, pytest) from
the module import block in apps/backend/tests/test_linear_validation_runner.py
so only actually used imports remain; update the import line(s) accordingly and
run tests/lint to confirm no missing references.
- Around line 48-58: The test currently skips assertions when the target file is
missing because of the exists() guard; update
test_linear_validator_authorization_pattern to assert the file exists first
(e.g., assert source_file.exists()) or remove the conditional so the test fails
if agents/linear_validator.py is absent, then proceed to read_text and assert
the authorization pattern checks ('startswith("lin_api_")' and 'f"Bearer
{api_key}"') against the content.
```

</details>

<!-- This is an auto-generated comment by CodeRabbit for review status -->

---

## Implementation Notes

*Status: SKIPPED*

**Reason:** Review state: COMMENTED

