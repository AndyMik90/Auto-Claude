# Comment: 0f7c68875a084d26

**Source:** coderabbitai
**Type:** comment
**File:** `apps/backend/runners/linear_validation_runner.py`
**Original ID:** 2717221735
**Created:** None
**Severity:** HIGH
**Status:** RESOLVED

---

## Original Content

_üõ†Ô∏è Refactor suggestion_ | _üü† Major_

**Extract shared serialization logic to reduce duplication.**

The result-to-dict serialization logic (lines 72-115 and 162-206) is nearly identical between `validate_single_ticket` and `validate_batch_tickets`. Extract a helper function to eliminate this duplication.


<details>
<summary>‚ôªÔ∏è Proposed refactor</summary>

```diff
+def _serialize_validation_result(result, ticket_id: str) -> dict:
+    """Convert validation result to JSON-serializable format."""
+    return {
+        "ticketId": ticket_id,
+        "ticketIdentifier": result.ticket_id,
+        "validationTimestamp": result.validation_timestamp,
+        "cached": result.cached,
+        "status": result.status,
+        "confidence": result.confidence,
+        "reasoning": result.reasoning,
+        "contentAnalysis": {
+            "title": result.content_analysis.title,
+            "descriptionSummary": result.content_analysis.description_summary,
+            "requirements": result.content_analysis.requirements,
+        },
+        "completenessValidation": {
+            "isComplete": result.completeness_validation.is_complete,
+            "score": result.completeness_validation.feasibility_score,
+            "missingFields": result.completeness_validation.missing_fields,
+            "validationNotes": result.completeness_validation.validation_notes,
+        },
+        "suggestedLabels": [
+            {
+                "name": label.name,
+                "confidence": label.confidence,
+                "reason": label.reason,
+            }
+            for label in result.suggested_labels
+        ],
+        "versionRecommendation": {
+            "currentVersion": result.version_recommendation.current_version,
+            "recommendedVersion": result.version_recommendation.recommended_version,
+            "versionType": result.version_recommendation.version_type,
+            "reasoning": result.version_recommendation.reasoning,
+        },
+        "taskProperties": {
+            "category": result.task_properties.category,
+            "complexity": result.task_properties.complexity,
+            "impact": result.task_properties.impact,
+            "priority": result.task_properties.priority,
+            "rationale": result.task_properties.rationale,
+            "acceptanceCriteria": result.content_analysis.requirements,
+        },
+    }
+
+
 async def validate_single_ticket(
     project_dir: Path,
     ticket_id: str,
     skip_cache: bool = False,
 ) -> dict:
     # ... docstring ...
     try:
         agent = create_linear_validator(project_dir, project_dir, model="opus")
         result = await agent.validate_ticket(ticket_id, skip_cache=skip_cache)
-        # Convert to serializable format
-        return {
-            "success": True,
-            "data": {
-                "ticketId": ticket_id,
-                # ... ~40 lines of serialization ...
-            },
-        }
+        return {
+            "success": True,
+            "data": _serialize_validation_result(result, ticket_id),
+        }
     except LinearValidationError as e:
         # ...
```
</details>


Also applies to: 161-206

<details>
<summary>ü§ñ Prompt for AI Agents</summary>

```
In `@apps/backend/runners/linear_validation_runner.py` around lines 71 - 115,
Extract the repeated serialization block into a single helper function (e.g.,
serialize_validation_result(result, ticket_id)) and replace the inline dict
construction in validate_single_ticket and validate_batch_tickets with calls to
it; the helper should map all fields currently built in the dict
(ticketId/ticketIdentifier/validationTimestamp/cached/status/confidence/reasoning,
contentAnalysis with title/descriptionSummary/requirements,
completenessValidation with isComplete/score/missingFields/validationNotes,
suggestedLabels as a list of {name,confidence,reason} from
result.suggested_labels, versionRecommendation with
currentVersion/recommendedVersion/versionType/reasoning, and taskProperties
including acceptanceCriteria wired from result.content_analysis.requirements),
preserve naming exactly, and ensure tests or callers still receive the same
serializable structure.
```

</details>

<!-- fingerprinting:phantom:poseidon:ocelot -->

<!-- This is an auto-generated comment by CodeRabbit -->

‚úÖ Addressed in commits 12e7884 to 1f1d23a

---

## Implementation Notes

*Status: RESOLVED*

**Resolution:** Body contains resolution marker

**Resolved At:** 2026-01-28T15:40:31.933944

