# Comment: da8422fb1697c77c

**Source:** coderabbitai
**Type:** comment
**File:** `apps/frontend/src/main/agent/agent-manager.ts`
**Line:** 699
**Original ID:** 2717221768
**Created:** None
**Severity:** LOW
**Status:** SKIPPED

---

## Original Content

_üßπ Nitpick_ | _üîµ Trivial_

**Significant code duplication between single and batch validation methods.**

`validateLinearTicket` and `validateLinearTicketBatch` share nearly identical process-spawning logic. Consider extracting a private helper method to reduce duplication and simplify maintenance.



<details>
<summary>‚ôªÔ∏è Suggested refactor pattern</summary>

```typescript
private async runLinearValidation(
  taskId: string,
  projectPath: string,
  args: string[],
  errorPrefix: string
): Promise<{ success: boolean; data?: any; error?: string } | null> {
  // Common pre-checks, process spawning, and output parsing
}

async validateLinearTicket(taskId: string, projectPath: string, ticketId: string, skipCache = false) {
  const args = ['--ticket-id', ticketId];
  if (skipCache) args.push('--skip-cache');
  return this.runLinearValidation(taskId, projectPath, args, 'Linear validation');
}

async validateLinearTicketBatch(taskId: string, projectPath: string, ticketIds: string[], skipCache = false) {
  const args = ['--ticket-ids', ticketIds.join(',')];
  if (skipCache) args.push('--skip-cache');
  return this.runLinearValidation(taskId, projectPath, args, 'Linear batch validation');
}
```
</details>

<details>
<summary>ü§ñ Prompt for AI Agents</summary>

```
In `@apps/frontend/src/main/agent/agent-manager.ts` around lines 491 - 699, Both
validateLinearTicket and validateLinearTicketBatch duplicate the same pre-checks
and child-process spawn/parse logic; extract that shared logic into a private
helper (e.g., runLinearValidation) which accepts taskId, projectPath, the runner
args array, and an errorPrefix; inside runLinearValidation perform the
autoBuildSource and runnerPath checks, build combinedEnv, spawn the child
process, collect stdout/stderr, JSON-parse stdout on success and return the
unified result shape, and on errors emit the appropriate task error and return
the failure object; update validateLinearTicket to call runLinearValidation with
args ["--project-dir", projectPath, "--ticket-id", ticketId] (plus
"--skip-cache" when needed) and validateLinearTicketBatch to call it with
["--project-dir", projectPath, "--ticket-ids", ticketIds.join(",")] so
duplication is removed.
```

</details>

<!-- fingerprinting:phantom:medusa:ocelot -->

<!-- This is an auto-generated comment by CodeRabbit -->

---

## Implementation Notes

*Status: SKIPPED*

**Resolution:** Trivial nitpick or suggestion - not blocking