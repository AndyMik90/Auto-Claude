# Comment: 79fd1d35ae68505a

**Source:** sentry
**Type:** comment
**File:** `apps/backend/agents/linear_similarity_agent.py`
**Line:** 345
**Original ID:** 2737152661
**Created:** None
**Severity:** HIGH
**Status:** RESOLVED

---

## Original Content

**Bug:** The `Authorization` header for Linear API calls is missing the required `Bearer ` prefix for OAuth tokens, which is inconsistent with the established pattern elsewhere in the codebase.
<sub>Severity: HIGH</sub>
<!-- BUG_PREDICTION -->

<details>
<summary><b title="Reference ID: `9335041`">Suggested Fix</b></summary>

Apply the existing authorization logic to ensure OAuth tokens are correctly handled. The header should be set using `authorization = api_key if api_key.startswith("lin_api_") else f"Bearer {api_key}"`. This fix should be applied in both `apps/backend/agents/linear_similarity_agent.py` and `apps/backend/agents/linear_utils.py`.
</details>

<details open>
<summary><b title="Reference ID: `9335041`">Prompt for AI Agent</b></summary>

```
Review the code at the location below. A potential bug has been identified by an AI
agent.
Verify if this is a real issue. If it is, propose a fix; if not, explain why it's not
valid.

Location: apps/backend/agents/linear_similarity_agent.py#L340-L345

Potential issue: The `Authorization` header for Linear API calls is constructed directly
as `{"Authorization": api_key}` in `_fetch_team_tickets` and a similar utility function.
This implementation is missing the logic to prepend `Bearer ` to the token when an OAuth
key is used, which is the established pattern in at least four other locations in the
codebase. This will cause API requests to fail with a `401 Unauthorized` error for any
user authenticating with a Linear OAuth token, breaking features like ticket similarity
analysis.
```
</details>

<!--
<sub>Reference ID: `9335041`</sub>-->

---

## Suggested Fix

```python
Review the code at the location below. A potential bug has been identified by an AI
agent.
Verify if this is a real issue. If it is, propose a fix; if not, explain why it's not
valid.

Location: apps/backend/agents/linear_similarity_agent.py#L340-L345

Potential issue: The `Authorization` header for Linear API calls is constructed directly
as `{"Authorization": api_key}` in `_fetch_team_tickets` and a similar utility function.
This implementation is missing the logic to prepend `Bearer ` to the token when an OAuth
key is used, which is the established pattern in at least four other locations in the
codebase. This will cause API requests to fail with a `401 Unauthorized` error for any
user authenticating with a Linear OAuth token, breaking features like ticket similarity
analysis.
```

---

## Implementation Notes

*Status: RESOLVED*

**Resolution:** Fixed both linear_similarity_agent.py and linear_utils.py to add Bearer prefix for OAuth tokens

### Fix Commit

`2cbfc56992d4f114432a48fd7acd407c1b0aea52`