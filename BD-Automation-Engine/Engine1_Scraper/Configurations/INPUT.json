{"browserLog":false,"closeCookieModals":false,"customData":{"keywords":["Secret","TS/SCI","TS","Top Secret","SCI","Poly","TSSCI","Polygraph"]},"debugLog":false,"downloadCss":false,"downloadMedia":false,"headless":true,"ignoreCorsAndCsp":false,"ignoreSslErrors":false,"keepUrlFragments":false,"maxConcurrency":1,"maxCrawlingDepth":0,"maxPagesPerCrawl":0,"maxRequestRetries":3,"maxResultsPerCrawl":0,"maxScrollHeightPixels":5000,"pageFunction":"async function pageFunction(context) { \n  const { page, customData } = context;\n  const sleep = (ms) => new Promise(r => setTimeout(r, ms));\n  \n  // Get keywords from customData\n  const keywords = (customData && Array.isArray(customData.keywords)) ? customData.keywords : ['Secret'];\n  \n  // Keyword priority for deduplication (higher index = higher priority)\n  const keywordPriority = {\n    'Secret': 8,\n    'TS/SCI': 7,\n    'TS': 6,\n    'Top Secret': 5,\n    'SCI': 4,\n    'Poly': 3,\n    'TSSCI': 2,\n    'Polygraph': 1\n  };\n  \n  // Global deduplication map to track jobs and their best keyword\n  const globalJobsMap = new Map(); // URL -> job object\n  \n  // Smart clearance detection function\n  function detectClearanceLevel(title, description = '') {\n    const text = (title + ' ' + description).toLowerCase();\n    \n    // Check for TS/SCI variants first (highest priority)\n    if (text.includes('ts/sci') || text.includes('ts-sci') || text.includes('tssci')) {\n      return 'TS/SCI';\n    }\n    \n    // Check for Poly variants\n    if (text.includes('ci poly') || text.includes('fs poly') || text.includes('polygraph') || text.includes('poly')) {\n      return 'Poly';\n    }\n    \n    // Check for TS (but not SCI)\n    if ((text.includes(' ts ') || text.includes('top secret')) && !text.includes('sci')) {\n      return 'TS';\n    }\n    \n    // Check for Secret (but not TS)\n    if (text.includes('secret') && !text.includes('top secret') && !text.includes(' ts ')) {\n      return 'Secret';\n    }\n    \n    // Check for SCI alone\n    if (text.includes('sci')) {\n      return 'SCI';\n    }\n    \n    return null;\n  }\n  \n  // Extract location from URL pattern\n  function extractLocation(url) {\n    // Pattern: /state/city/ in URL\n    const match = url.match(/\\/jobs\\/find_a_job\\/([^/]+)\\/([^/]+)\\//i);\n    if (match) {\n      const state = match[1].replace(/-/g, ' ');\n      const city = match[2].replace(/-/g, ' ');\n      // Capitalize each word\n      const formatLocation = (str) => str.split(' ').map(word => \n        word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()\n      ).join(' ');\n      return formatLocation(city) + ', ' + formatLocation(state);\n    }\n    return 'Location TBD';\n  }\n  \n  async function waitForJobs(timeout = 30000) {\n    try {\n      await page.waitForFunction(\n        () => Array.from(document.querySelectorAll('a[href*=\"/job-\"]')).some(a => /\\/job-\\d+\\//.test(a.getAttribute('href'))),\n        { timeout }\n      );\n      return true;\n    } catch(e) {\n      console.log('No jobs found on this page');\n      return false;\n    }\n  }\n  \n  async function scrapeKeyword(kw) {\n    console.log(`\\n=== Searching for keyword: ${kw} ===`);\n    const base = 'https://insightglobal.com/jobs/find_a_job/';\n    // Search without location to get ALL jobs nationally\n    const url = base + '?srch=' + encodeURIComponent(kw);\n    const jobsForThisKeyword = [];\n    \n    console.log(`Starting URL: ${url}`);\n    await page.goto(url, { waitUntil: 'networkidle2', timeout: 45000 });\n    \n    // Check if jobs exist\n    const hasJobs = await waitForJobs();\n    if (!hasJobs) {\n      console.log(`No jobs found for keyword ${kw}`);\n      return jobsForThisKeyword;\n    }\n    \n    // Paginate through all result pages\n    let pageNum = 1;\n    const maxPages = 100; // Safety limit\n    \n    while (pageNum <= maxPages) {\n      console.log(`Processing page ${pageNum} for keyword: ${kw}`);\n      \n      // Extract job links from current page\n      const pageJobs = await page.$$eval('a[href*=\"/job-\"]', \n        els => els.map(e => ({\n          title: e.innerText.trim(),\n          url: e.href\n        })).filter(x => /\\/job-\\d+\\//.test(x.url))\n      );\n      \n      console.log(`Found ${pageJobs.length} jobs on page ${pageNum}`);\n      \n      // Process each job\n      for (const job of pageJobs) {\n        const location = extractLocation(job.url);\n        \n        const jobData = {\n          title: job.title,\n          company: 'Insight Global',\n          location: location,\n          primary_keyword: kw,\n          url: job.url,\n          detected_clearance: detectClearanceLevel(job.title),\n          scraped_at: new Date().toISOString()\n        };\n        \n        // Check if we've seen this job before\n        if (globalJobsMap.has(job.url)) {\n          const existingJob = globalJobsMap.get(job.url);\n          const existingPriority = keywordPriority[existingJob.primary_keyword] || 0;\n          const currentPriority = keywordPriority[kw] || 0;\n          \n          // Update if current keyword has higher priority\n          if (currentPriority > existingPriority) {\n            existingJob.primary_keyword = kw;\n            console.log(`Updated job primary keyword from ${existingJob.primary_keyword} to ${kw}`);\n          }\n        } else {\n          // New job, add to map\n          globalJobsMap.set(job.url, jobData);\n          jobsForThisKeyword.push(jobData);\n        }\n      }\n      \n      // Check for next page arrow\n      const nextPageLink = await page.evaluate(() => {\n        const nextLink = document.querySelector('a.page-link[title=\"Page Forward\"]');\n        return nextLink ? nextLink.href : null;\n      });\n      \n      if (!nextPageLink) {\n        console.log(`No more pages for keyword ${kw} (stopped at page ${pageNum})`);\n        break;\n      }\n      \n      // Navigate to next page\n      console.log(`Going to page ${pageNum + 1} for keyword ${kw}`);\n      await page.goto(nextPageLink, { waitUntil: 'networkidle2', timeout: 45000 });\n      await sleep(Math.random() * 1500 + 500); // Random delay 0.5-2 seconds\n      \n      // Wait for jobs to load on new page\n      const hasMoreJobs = await waitForJobs();\n      if (!hasMoreJobs) {\n        console.log(`No jobs on page ${pageNum + 1}, ending search for ${kw}`);\n        break;\n      }\n      \n      pageNum++;\n    }\n    \n    console.log(`Completed keyword ${kw}: Found ${jobsForThisKeyword.length} new unique jobs`);\n    return jobsForThisKeyword;\n  }\n  \n  // Main scraping loop - iterate through keywords IN ORDER\n  console.log(`Starting nationwide Insight Global scrape`);\n  console.log(`Keywords to search: ${keywords.join(', ')}`);\n  console.log(`Priority order: ${keywords.join(' > ')}`);\n  console.log('Searching ALL locations nationally for each keyword\\n');\n  \n  for (const keyword of keywords) {\n    try {\n      await scrapeKeyword(keyword);\n      \n      // Add delay between keyword searches to avoid rate limiting\n      console.log(`Waiting before next keyword...`);\n      await sleep(Math.random() * 3000 + 2000); // 2-5 seconds\n      \n    } catch (error) {\n      console.error(`Error scraping keyword ${keyword}:`, error.message);\n      // Continue with next keyword even if one fails\n    }\n  }\n  \n  // Convert map to array for final output\n  const finalJobs = Array.from(globalJobsMap.values()).map(job => ({\n    company: job.company,\n    detected_clearance: job.detected_clearance,\n    location: job.location,\n    primary_keyword: job.primary_keyword,\n    scraped_at: job.scraped_at,\n    title: job.title,\n    url: job.url\n  }));\n  \n  console.log(`\\n=== SCRAPING COMPLETE ===`);\n  console.log(`Total unique jobs found: ${finalJobs.length}`);\n  \n  // Clearance breakdown\n  console.log(`\\nClearance level breakdown:`);\n  const clearanceStats = {};\n  finalJobs.forEach(job => {\n    const level = job.detected_clearance || 'Unknown';\n    clearanceStats[level] = (clearanceStats[level] || 0) + 1;\n  });\n  Object.entries(clearanceStats)\n    .sort((a, b) => b[1] - a[1])\n    .forEach(([level, count]) => {\n      console.log(`  ${level}: ${count} jobs`);\n    });\n  \n  // Top locations\n  console.log(`\\nTop 10 locations:`);\n  const locationStats = {};\n  finalJobs.forEach(job => {\n    locationStats[job.location] = (locationStats[job.location] || 0) + 1;\n  });\n  Object.entries(locationStats)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 10)\n    .forEach(([location, count]) => {\n      console.log(`  ${location}: ${count} jobs`);\n    });\n  \n  // Return deduplicated results\n  return finalJobs;\n}","pageFunctionTimeoutSecs":1800,"pageLoadTimeoutSecs":60,"proxyConfiguration":{"useApifyProxy":true},"proxyRotation":"RECOMMENDED","respectRobotsTxtFile":false,"startUrls":[{"url":"https://insightglobal.com/jobs/find_a_job/","method":"GET"}],"useChrome":true,"waitUntil":["networkidle2"],"globs":[],"pseudoUrls":[],"excludes":[],"initialCookies":[]}